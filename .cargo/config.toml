# Cargo 配置文件，用于优化构建性能和处理跨编译问题

[build]
# 增加并行编译任务数
jobs = 4

[net]
# 网络超时配置
retry = 3
git-fetch-with-cli = true
offline = false

# 注册表配置
[registries.crates-io]
protocol = "sparse"

# HTTP 超时配置
[http]
timeout = 300             # 5 分钟超时 (秒)
low-speed-limit = 10      # 10 bytes/sec
multiplexing = true
user-agent = "cargo"

# 环境变量配置 - 解决 glib-sys 跨编译问题
[env]
PKG_CONFIG_ALLOW_CROSS = { value = "1", relative = true }

# 目标配置
# Windows 目标使用 x86-64-v2 以确保更好的兼容性
# x86-64-v2 支持 2009 年后的大多数 CPU (包含 SSE4.2, POPCNT 等指令)
# 如果需要最大兼容性，可以改为 "x86-64"（基础指令集）
[target.x86_64-pc-windows-msvc]
rustflags = ["-C", "target-cpu=x86-64-v2"]

# 32 位 Windows 目标
[target.i686-pc-windows-msvc]
rustflags = ["-C", "target-cpu=pentium4"]

# Linux 和 macOS 可以使用 native，因为通常是用户自己编译
[target.x86_64-unknown-linux-gnu]
rustflags = ["-C", "target-cpu=native"]
# Linux 专用环境变量
[target.x86_64-unknown-linux-gnu.env]
PKG_CONFIG_ALLOW_CROSS = "1"
PKG_CONFIG_PATH = "/usr/lib/pkgconfig:/usr/share/pkgconfig"

[target.x86_64-apple-darwin]
rustflags = ["-C", "target-cpu=native"]

[target.aarch64-apple-darwin]
rustflags = ["-C", "target-cpu=native"]


# 专门为 32 位 Linux 目标添加配置（如果需要）
[target.i686-unknown-linux-gnu]
rustflags = ["-C", "target-cpu=native"]
[target.i686-unknown-linux-gnu.env]
PKG_CONFIG_ALLOW_CROSS = "1"
PKG_CONFIG_PATH = "/usr/lib/i386-linux-gnu/pkgconfig:/usr/share/pkgconfig"
