# InfloWave v0.7.3 发布说明

## 🎉 编辑器与数据洞察增强版本

### 📦 核心改进

本版本专注于提升 SQL 编辑器功能、增强数据洞察分析能力、优化图表可视化体验，并改进查询结果展示，为用户提供更强大的数据分析工具。

## ✨ 新增功能

### 📝 SQL 编辑器增强

#### 智能编辑功能
- **新增** 智能大小写功能，根据用户输入自动调整关键字大小写
- **实现** SQL 格式化功能，支持自动格式化与粘贴格式化
- **添加** 选中文本执行功能，支持执行编辑器中选中的 SQL 语句
- **支持** 时间范围查询功能，可在查询中添加时间范围条件
- **优化** 编辑器内容同步逻辑，保持光标位置并避免重复更新

#### 数据复制功能
- **新增** 多种数据复制格式支持：
  - 纯文本格式
  - INSERT SQL 语句
  - Markdown 表格
  - JSON 格式
  - CSV 格式
- **实现** 数据表 INSERT SQL 生成功能，自动识别数据源类型
- **支持** 键盘快捷键 Cmd/Ctrl+C 快速复制为 SQL
- **添加** 复制成功提示与错误处理

#### 编辑器配置优化
- **禁用** 代码折叠和空白字符可视化显示
- **禁用** 缩进参考线显示，提供更简洁的编辑界面
- **启用** 桌面应用原生剪贴板功能
- **配置** 缩进、查找、括号匹配等编辑器行为
- **启用** 平滑滚动与光标动画，改善用户体验

#### 语言支持增强
- **增强** 数据库语言支持和编辑器配置
- **预注册** InfluxDB 和 IoTDB 等增强语言支持
- **支持** InfluxQL 时间函数表达式（如 now()）
- **区分** 处理相对时间和绝对时间戳
- **修复** 语法高亮中的正则表达式和语言 ID 问题

### 📊 数据洞察分析

#### 智能洞察功能
- **实现** 多查询数据洞察功能，支持同时分析多个查询结果
- **新增** 查询性能分析，根据执行时间提供优化建议
- **添加** 数据量分析，针对大数据集给出聚合建议
- **集成** 数据质量检测，识别高比例空值字段
- **实现** 时序数据分析，检测长时间跨度数据并建议聚合

#### 数据质量分析
- **完善** 数据质量分析，新增部分字段空值和无空值的检测
- **细化** 时间跨度分析，支持超长、短时间跨度及采样率检测
- **增加** 采样间隔均匀性检测，识别数据采集不稳定性
- **新增** 数值字段分析，包括零值、负值、常量字段和波动性检测
- **添加** 字段统计建议，如字段数量过多和低/高基数字段识别
- **实现** 数据趋势分析，检测显著上升/下降趋势和异常值

#### 字段统计功能
- **新增** 计算所有查询结果的字段统计信息逻辑
- **重构** 字段统计标签页以支持多查询展示
- **添加** 可滚动的 Tab 列表以改善多标签页体验
- **优化** 统计表格展示，按查询分组显示字段统计
- **增加** 查询级别的统计信息展示（字段数、行数等）
- **实现** 统计信息的完整数值计算（最小值、最大值、平均值、中位数）
- **支持** 导出多个查询的字段统计信息为 Excel 文件

### 📈 图表可视化增强

#### 新增图表类型
- **新增** 面积图、散点图、热力图、雷达图支持
- **添加** 分类柱状图和分类饼图功能
- **支持** 饼图和雷达图选择特定时间点展示
- **添加** 时间轴滑块控制器，允许用户在多个时间点间切换

#### 图表配置功能
- **支持** 自定义图表标题和字段别名
- **添加** 字段选择器，支持自定义图表显示字段
- **实现** 字段别名映射逻辑，用于图表图例和轴标签显示
- **添加** 分类字段选择器，支持用户选择字符串类型的字段进行统计

#### 图表导出优化
- **移除** ECharts 的 toolbox 配置，简化桌面应用界面
- **简化** 导出图表功能，仅支持 PNG 格式导出
- **更新** 导出逻辑以适配 Tauri 新 API
- **优化** 图表导出功能的错误处理逻辑
- **修复** 用户取消保存操作时的错误提示

### 🎨 查询结果展示优化

#### 操作结果面板重构
- **重构** 操作结果面板展示逻辑，使用 Card 组件重新设计
- **添加** DELETE 语句专属的操作详情和重要提示卡片
- **添加** INSERT 语句写入详情、成功提示及 Line Protocol 格式说明
- **添加** DROP 语句操作详情和危险警告提示
- **添加** 通用执行统计信息展示模块
- **引入** ScrollArea 实现结果内容区域滚动

#### 执行器标签页重构
- **重构** 执行器标签页 UI 并增强功能展示
- **重新设计** 执行概览卡片，增加状态徽章和统计信息
- **添加** 性能分析卡片，展示执行效率和数据量进度条
- **新增** 优化建议卡片，根据执行时间和数据量提供智能提示
- **重构** 查询详情展示，支持错误信息显示和行数统计
- **优化** 查询列表展示，增加 hover 效果和复制按钮

#### 增强结果面板功能
- **实现** 写入操作的分组合并显示
- **优化** 各类 SQL 语句的展示界面与操作反馈
- **改进** 文件保存逻辑以正确处理用户取消操作
- **限制** 数值字段选择器仅在适用图表类型显示
- **按置信度排序** 查询结果洞察信息

### ⚙️ 查询性能优化

#### 执行时间优化
- **区分** 后端执行时间与总耗时显示
- **新增** 计算后端实际执行时间的逻辑
- **修改** 日志输出，分别显示后端执行耗时和总耗时
- **更新** 查询结果中的执行时间字段为后端返回值

#### 查询逻辑优化
- **优化** 数据库类型获取逻辑，避免重复计算
- **使用** useMemo 缓存 dbType 和 detectedType 值
- **避免** 因对象引用变化导致的无限循环
- **减少** 不必要的组件重新渲染

## 🐛 重要修复

### 🔨 编辑器修复
- **修复** 语法高亮中的正则表达式和语言 ID 问题
- **修复** 数据库类型中点号导致的语言 ID 注册失败问题
- **统一** 修正了数字浮点数匹配规则中的正负号字符类
- **优化** 编辑器布局和滚动条配置
- **移除** 多余的 overflow-hidden 类

### 📊 图表修复
- **修复** 图表数据索引越界问题
- **添加** 安全索引检查，防止数据索引超出范围
- **实现** 切换 tab 时重置时间点索引
- **优化** 雷达图布局，调整中心点位置和半径避免与标题重叠

### 🔧 错误处理优化
- **添加** 数据类型不兼容错误提示
- **解析** 并展示 InfluxDB 原始错误信息
- **提供** 更友好的查询错误提示和建议
- **增强** DELETE 语句错误提示信息，提供语法指导

## 🎨 界面优化

### 🖼️ 布局改进
- **调整** 面板默认尺寸，将底部面板从 40 调整为 65
- **优化** 增强结果面板的间距和图标大小
- **减小** 洞察内容容器的内边距和间距
- **统一** 调整各类图标的尺寸
- **优化** 卡片内容区域的内边距和文本行高

### 📐 样式优化
- **添加** 暗色主题支持，优化不同数据类型的徽章样式
- **改进** 查询结果显示样式，支持滚动和自动换行
- **优化** 查询项的视觉层次和交互效果
- **增强** 可读性和视觉层次感

## 🚀 性能优化

### ⚡ 渲染性能优化
- **优化** 编辑器内容同步逻辑，避免不必要的重新渲染
- **添加** 内部变更标记，防止 setValue 触发不必要的 onChange 回调
- **使用** useMemo 缓存计算值，减少重复计算
- **优化** 组件依赖项，确保响应式更新正确触发

### 📊 数据处理优化
- **优化** 空值百分比计算逻辑，基于各查询结果独立计算
- **改进** 字段统计计算性能
- **优化** 洞察计数逻辑，准确统计所有查询的洞察总数

## 🔧 技术改进

### 📋 代码重构
- **重构** 图表配置生成逻辑，提取独立工具函数
- **重构** TimeRangeSelector 组件，移除内部状态管理并简化逻辑
- **统一** 使用 camelCase 参数名调用后端保存接口
- **优化** 代码可读性和维护性

### 🛠️ 依赖更新
- **引入** sonner 库用于显示复制结果的提示信息
- **更新** Tauri 命令调用方式，使用新的 API 格式
- **优化** 组件导入和引用关系

### 🔍 调试增强
- **添加** 详细的日志记录
- **移除** 用户取消保存时的冗余日志输出
- **优化** 调试信息输出

## 📦 组件更新

### 🔄 新增组件
- **新增** 字段统计导出对话框组件
- **添加** 分类字段选择器组件
- **实现** 时间轴滑块控制器组件
- **添加** 图表标题编辑功能组件

### 🎯 组件优化
- **优化** TableToolbar 组件以支持多种复制格式
- **重构** EnhancedResultPanel 组件，支持多查询展示
- **改进** EditorManager 组件，支持更精确的语言检测和设置

## 🔄 兼容性

### 📱 平台支持
- **Windows** 10/11 (x64/x86) - 新增 MSI 打包支持
- **macOS** 10.15+ (Intel/Apple Silicon)
- **Linux** Ubuntu 20.04+, CentOS 8+, Fedora 35+ (x64/ARM64)

### 🗄️ 数据库支持
- **InfluxDB** 1.x - 增强时间函数表达式支持
- **InfluxDB** 2.x
- **IoTDB** - 持续支持
- **MySQL** - INSERT SQL 生成支持

## 📝 开发者工具

### 🛠️ 新增配置
```typescript
// 图表配置
{
  customTitle?: string,           // 自定义图表标题
  fieldAliases?: Record<string, string>, // 字段别名映射
  timeIndex?: number,             // 时间点索引
  selectedFields?: string[]       // 选中的字段
}

// 编辑器配置
{
  formatOnPaste: boolean,         // 粘贴时格式化
  formatOnType: boolean,          // 输入时格式化
  smoothScrolling: boolean,       // 平滑滚动
  cursorBlinking: 'smooth'        // 光标动画
}
```

### 📋 Tauri 命令
```rust
// 文件保存对话框
save_file_dialog(options: SaveDialogOptions) -> Option<String>

// 剪贴板操作
write_text(text: String)
read_text() -> String
```

## 🔮 下一步计划

### 🎯 v0.7.4 计划
- **增强** 数据库资源管理器功能
- **优化** 树形结构性能
- **改进** 连接状态管理

### 🚀 v0.8.0 展望
- **新增** 更多数据可视化图表类型
- **扩展** 数据导出格式支持
- **增强** 多数据源联合查询

## 🙏 致谢

感谢所有用户的反馈和建议，特别是在编辑器功能和数据洞察分析方面提出宝贵意见的用户。

## 📞 支持

如果您在使用过程中遇到任何问题，请通过以下方式联系我们：

- **GitHub Issues**: [https://github.com/chenqi92/inflowave/issues](https://github.com/chenqi92/inflowave/issues)
- **讨论区**: [https://github.com/chenqi92/inflowave/discussions](https://github.com/chenqi92/inflowave/discussions)
- **邮箱**: support@kkape.com

---

**完整更新日志**: [v0.7.2...v0.7.3](https://github.com/chenqi92/inflowave/compare/v0.7.2...v0.7.3)

