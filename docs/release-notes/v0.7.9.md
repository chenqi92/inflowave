# InfloWave v0.7.9 发布说明

## 🎉 编辑器重构与数据库管理增强版本

### 📦 核心改进

本版本进行了重大架构升级，将代码编辑器从 Monaco Editor 迁移至 CodeMirror 6，全面增强了数据库管理功能，优化了用户界面交互体验，并改进了数据浏览和操作能力。

## ✨ 新增功能

### 📝 编辑器重构 (Monaco → CodeMirror 6)

#### 编辑器迁移
- **重构** 将编辑器从 Monaco Editor 完全迁移至 CodeMirror 6
- **移除** @monaco-editor/react 和 monaco-editor 依赖
- **引入** CodeMirror 6 相关组件和扩展
- **使用** SimpleCodeEditor 替代原 Editor 组件
- **简化** 剪贴板操作和内容变更处理逻辑
- **优化** 编辑器挂载和卸载时的资源清理逻辑

#### 语言支持增强
- **添加** 多种数据库方言支持（SQL、InfluxQL、Flux 等）
- **实现** 基于 CodeMirror 6 的智能提示和格式化功能
- **改进** 主题和语言设置的处理方式
- **新增** SQL 语句解析功能
- **支持** 主题动态更新

#### 代码补全优化
- **增强** 代码编辑器的语法提示功能
- **优化** 代码编辑器自动补全功能
- **优化** 代码补全界面视觉效果
- **清除** CodeMirror 默认图标内容
- **改进** 代码编辑器功能和连接信息显示

### 🗄️ 数据库管理增强

#### 数据浏览器
- **新增** 数据浏览器功能，支持可视化浏览数据库内容
- **添加** 统计分析功能，提供数据洞察
- **优化** InfluxDB 查询生成逻辑
- **实现** 数据浏览器标签页防重复加载机制
- **添加** loadingTabsRef 防止双击时重复触发标签页加载
- **实现** refreshDataBrowserTab 方法用于刷新数据
- **添加** loading 遮罩层和刷新触发逻辑

#### 数据库操作命令
- **新增** 创建和删除数据库功能
- **支持** 创建、删除和修改保留策略
- **支持** 删除 measurement 功能
- **完善** 命令列表注释说明和返回类型提示

#### 保留策略管理
- **增强** 保留策略管理功能
- **添加** 保留策略查看模式支持
- **实现** 保留策略详情查看功能
- **添加** 持续时间格式标准化处理
- **修复** 保留策略创建时 SQL 语法顺序问题
- **禁用** 查看模式下的表单编辑功能

#### 数据库信息获取
- **重构** 数据库信息获取逻辑
- **实现** 数据库节点局部刷新功能
- **优化** 树节点缓存清理逻辑
- **修复** 数据库名称传递不一致问题

#### 测量节点增强
- **支持** 测量节点下的标签和字段分组显示
- **移除** 字段和标签详情功能（简化界面）
- **移除** 表创建和查询管理功能
- **优化** 上下文菜单

### 🌲 树形结构优化

#### 节点展开逻辑
- **重构** 树节点双击行为和展开逻辑
- **优化** 树节点展开逻辑和 tab 创建防重机制
- **引入** useTabOperations 钩子用于 tab 操作
- **实现** handleToggleExpand 回调统一处理节点展开/收起
- **使用** creatingTabsRef 防止重复创建相同 tab
- **通过** expandedNodeIds 数组精确控制节点展开状态
- **修复** 节点展开状态判断逻辑，提高树组件性能

#### Loading 状态管理
- **实现** 节点独立 loading 状态管理
- **添加** nodeLoadingStates 状态用于独立管理各节点加载状态
- **防止** 重复触发加载操作，提升用户体验
- **优化** hasChildren 计算逻辑，加载时始终显示展开箭头
- **修复** 加载失败时未清除 isLoading 标志的问题

### 🔌 连接管理优化

#### 连接配置
- **添加** 连接配置分享功能
- **支持** 导出不包含敏感信息的连接配置
- **优化** 创建数据库对话框，支持从右键菜单传入连接 ID
- **动态调整** 不同数据库类型的创建对话框标题和描述
- **优化** 连接配置同步逻辑

#### 右键菜单功能
- **添加** 连接测试功能
- **添加** 连接信息查看功能
- **添加** 复制连接名功能
- **修复** 创建数据库时参数名称与后端不匹配的问题
- **改进** 错误提示和用户引导信息

### 📊 数据操作增强

#### 多格式数据复制
- **实现** 多格式数据复制功能
- **新增** CopyFormat 类型定义，支持 text、insert、markdown、json、csv 格式
- **重构** 数据复制逻辑，将单一复制函数拆分为按格式复制
- **添加** 复制格式选择器，使用 DropdownMenuRadioGroup 实现
- **优化** 文本格式复制，使用制表符分隔替代空格分隔
- **改进** 复制成功提示，显示具体的复制格式和数据量

#### INSERT SQL 生成
- **新增** INSERT SQL 语句生成功能
- **添加** generateInsertSQL 方法到 GlideDataTable 组件
- **支持** 多种数据库类型的 INSERT 语句生成

### 📈 可视化增强

#### 图表功能
- **添加** 图表搜索和类型过滤功能
- **优化** 图表选择和配置体验

### 🎨 界面优化

#### 对话框改进
- **替换** 数据库管理对话框为侧边栏组件（Sheet）
- **将** ConnectionDetailDialog、FieldDetailDialog、ManagementNodeDialog 和 TagDetailDialog 的 Dialog 替换为 Sheet
- **新增** ExpandableSearchInput 组件，支持展开搜索和自动聚焦
- **添加** Sheet 组件 size 属性支持（sm、md、lg、xl、2xl、3xl、4xl、full）
- **调整** 对话框内容布局，使用 flex 布局实现固定头部和可滚动内容区域

#### 组件样式统一
- **统一优化** 组件视觉样式和交互细节
- **添加** 统一的内阴影和悬停效果
- **优化** 工具栏按钮样式，使用紧凑型图标按钮设计
- **更新** 标签页样式为底部边框激活指示器
- **添加** Tooltip 提示到各类操作按钮
- **移除** 右侧功能面板中的描述文字以简化界面

#### 搜索框优化
- **引入** 可展开搜索框组件
- **更新** 数据库浏览器头部搜索框
- **添加** 扩展管理器可展开搜索框
- **添加** 查询历史组件可展开搜索框

### 📋 日志系统增强

#### 日志查看器
- **实现** 前后端日志分离查看功能
- **添加** 系统日志查看功能
- **集成** 日志查看到通知面板
- **调整** 日志查看器自动滚动行为
- **替换** 自动滚动图标为 ChevronsDown
- **优化** 后台日志查看器界面

#### 日志输出优化
- **注释** 文件读写成功的日志输出
- **注释** 文件读取成功的日志输出
- **注释** 文件信息获取函数中的调试打印语句
- **禁用** 文件存在性检查的日志输出
- **移除** 调试日志输出

### 🔔 通知系统优化

#### Toast 通知
- **启用** 通知和吐司的默认关闭按钮
- **设置** 默认可手动关闭（dismissible）选项
- **优化** Sonner Toast 关闭按钮样式与位置
- **添加** closeButton 样式和定位
- **添加** 一致的阴影样式

#### 扩展管理器
- **优化** 扩展管理器界面
- **将** Dialog 替换为 Popover 以改善用户体验
- **添加** 状态过滤下拉菜单替代原有选择器
- **优化** 刷新和添加扩展按钮的布局与样式

### 🛠️ 开发工具优化

#### 性能监控
- **添加** Tooltip 提示到性能监控组件
- **简化** 控制栏设计

#### 开发工具面板
- **重构** 开发工具面板的标签页布局结构
- **优化** 面板组织和导航

## 🐛 重要修复

### 🔨 编辑器修复
- **修复** 字体文件路径中的多余引号
- **确保** 字体文件路径格式正确，避免加载错误
- **保持** 与其它字体文件路径格式的一致性

### 🌲 树形结构修复
- **优化** MultiConnectionTreeView 断开连接时的节点清理逻辑
- **改进** dataLoader 节点存在性检查以避免访问不存在的节点
- **修复** 节点展开状态判断逻辑

### 🔧 其他修复
- **修复** 创建数据库时参数名称与后端不匹配的问题
- **修复** 系统节点隐藏状态下的按钮样式问题
- **修复** 复制功能依赖数组，确保正确的事件监听绑定

## 🎨 代码质量

### 📋 代码重构
- **重构** 编辑器管理逻辑以适配 CodeMirror 6 API
- **移除** 与 Monaco 相关的复杂配置和语言注册逻辑
- **统一** UI 组件导入路径为小写格式
- **重构** 数据库信息获取逻辑
- **优化** 组件重新渲染逻辑，确保状态变化时正确更新

### 🧹 代码清理
- **移除** 字段和标签详情功能
- **移除** 表创建和查询管理功能
- **移除** Monaco Editor 相关依赖
- **注释** 冗余的调试日志输出

## 🚀 性能优化

### ⚡ 渲染性能
- **优化** 树组件性能
- **减少** 不必要的组件重新渲染
- **优化** 组件依赖列表以包含新的状态管理变量

### 📊 加载性能
- **防止** 重复触发加载操作
- **实现** 标签页防重复加载机制
- **优化** 节点加载状态管理

## 🔄 兼容性

### 📱 平台支持
- **Windows** 10/11 (x64/x86)
- **macOS** 10.15+ (Intel/Apple Silicon)
- **Linux** Ubuntu 20.04+, CentOS 8+, Fedora 35+ (x64/ARM64)

### 🗄️ 数据库支持
- **InfluxDB** 1.x - 增强查询生成和保留策略管理
- **InfluxDB** 2.x - 完整支持
- **IoTDB** - 持续支持
- **MySQL** - INSERT SQL 生成支持

## 🔮 下一步计划

### 🎯 v0.8.0 计划
- **增强** 数据可视化能力
- **优化** 查询性能
- **扩展** 更多数据源支持

### 🚀 未来展望
- **新增** 数据导入导出功能
- **实现** 查询结果缓存
- **支持** 多数据源联合查询

## 🙏 致谢

感谢所有用户的反馈和建议，特别是在编辑器体验和数据库管理方面提出宝贵意见的用户。

## 📞 支持

如果您在使用过程中遇到任何问题，请通过以下方式联系我们：

- **GitHub Issues**: [https://github.com/chenqi92/inflowave/issues](https://github.com/chenqi92/inflowave/issues)
- **讨论区**: [https://github.com/chenqi92/inflowave/discussions](https://github.com/chenqi92/inflowave/discussions)
- **邮箱**: support@kkape.com

---

**完整更新日志**: [v0.7.8...v0.7.9](https://github.com/chenqi92/inflowave/compare/v0.7.8...v0.7.9)

