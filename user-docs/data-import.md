# 📥 数据写入

InfloWave 提供了多种数据写入方式，支持单条数据写入、批量导入和文件导入。本指南将详细介绍各种数据写入方法。

## 📊 数据写入概述

### 支持的写入方式
- **手动写入** - 单条数据手动输入
- **批量写入** - 多条数据批量提交
- **文件导入** - CSV、JSON 文件导入
- **Line Protocol** - InfluxDB 原生格式写入

### 数据格式要求
- **时间戳** - 必须包含时间字段
- **测量名称** - 数据所属的测量（表）
- **字段** - 实际的数值数据
- **标签** - 可选的元数据信息

## ✍️ 手动数据写入

### 切换到数据写入页面

1. 点击顶部导航的 **"数据写入"** 标签
2. 或使用快捷键 `Ctrl + 4`

### 单条数据写入

1. **选择目标**
   - 选择数据库连接
   - 选择目标数据库
   - 输入测量名称

2. **填写数据**
   - **时间戳** - 可选择当前时间或自定义
   - **字段数据** - 添加一个或多个字段
   - **标签数据** - 添加可选的标签信息

3. **提交数据**
   - 点击 **"写入数据"** 按钮
   - 系统会验证数据格式并提交

### 示例：写入温度数据

```
测量名称: temperature
时间戳: 2024-01-15 10:30:00
字段:
  - value: 23.5 (float)
  - unit: celsius (string)
标签:
  - location: office (string)
  - sensor_id: temp001 (string)
```

## 📝 Line Protocol 写入

### Line Protocol 格式

Line Protocol 是 InfluxDB 的原生数据格式：

```
measurement,tag1=value1,tag2=value2 field1=value1,field2=value2 timestamp
```

### 格式说明

**基本结构**：
- `measurement` - 测量名称
- `tag1=value1` - 标签键值对（可选）
- `field1=value1` - 字段键值对（必需）
- `timestamp` - 时间戳（可选，默认当前时间）

**示例**：
```
temperature,location=office,sensor=temp001 value=23.5,unit="celsius" 1642248600000000000
cpu_usage,host=server1,region=us-east value=85.2 1642248600000000000
memory_usage,host=server1 used=4096,total=8192,percentage=50.0
```

### Line Protocol 写入操作

1. 在数据写入页面选择 **"Line Protocol"** 模式
2. 在文本框中输入 Line Protocol 格式的数据
3. 可以输入多行数据进行批量写入
4. 点击 **"写入数据"** 提交

## 📁 文件导入

### 支持的文件格式

**CSV 格式**
- 标准的逗号分隔值文件
- 支持自定义分隔符
- 第一行可以是列标题

**JSON 格式**
- 标准 JSON 数组格式
- 支持嵌套对象结构
- 灵活的字段映射

### CSV 文件导入

#### 准备 CSV 文件

示例 CSV 文件内容：
```csv
timestamp,location,sensor_id,temperature,humidity
2024-01-15 10:00:00,office,temp001,23.5,45.2
2024-01-15 10:05:00,office,temp001,24.1,44.8
2024-01-15 10:10:00,warehouse,temp002,18.3,52.1
```

#### 导入步骤

1. **选择文件**
   - 点击 **"导入文件"** 按钮
   - 选择 CSV 文件

2. **预览数据**
   - 系统会显示文件前几行数据
   - 检查数据格式是否正确

3. **配置映射**
   - **测量名称** - 指定数据写入的测量
   - **时间字段** - 选择时间戳列
   - **标签字段** - 选择作为标签的列
   - **数值字段** - 选择作为字段的列

4. **数据类型设置**
   - 为每个字段指定数据类型
   - 支持：整数、浮点数、字符串、布尔值

5. **开始导入**
   - 确认配置无误后点击 **"开始导入"**
   - 显示导入进度和结果

### JSON 文件导入

#### JSON 文件格式

示例 JSON 文件：
```json
[
  {
    "timestamp": "2024-01-15T10:00:00Z",
    "measurement": "temperature",
    "tags": {
      "location": "office",
      "sensor_id": "temp001"
    },
    "fields": {
      "temperature": 23.5,
      "humidity": 45.2
    }
  },
  {
    "timestamp": "2024-01-15T10:05:00Z",
    "measurement": "temperature",
    "tags": {
      "location": "office",
      "sensor_id": "temp001"
    },
    "fields": {
      "temperature": 24.1,
      "humidity": 44.8
    }
  }
]
```

#### 导入配置

JSON 导入支持更灵活的字段映射：
- 自动识别嵌套结构
- 支持数组数据展开
- 可自定义字段路径

## 🔧 高级写入功能

### 批量数据写入

**批量 Line Protocol**：
```
temperature,location=office value=23.5 1642248600000000000
temperature,location=office value=24.1 1642248660000000000
temperature,location=office value=23.8 1642248720000000000
```

**批量写入优势**：
- 提高写入性能
- 减少网络开销
- 支持事务性写入

### 数据验证

**自动验证**：
- 时间戳格式检查
- 数据类型验证
- 字段名称规范检查
- 数值范围验证

**错误处理**：
- 显示详细错误信息
- 支持部分数据写入
- 错误数据跳过选项

### 写入性能优化

**批量大小控制**：
- 默认批量大小：1000 条
- 可根据数据大小调整
- 避免单次写入过多数据

**并发写入**：
- 支持多线程写入
- 自动负载均衡
- 写入队列管理

## 📊 数据类型说明

### 字段数据类型

| 类型 | 说明 | 示例 |
|------|------|------|
| Float | 浮点数 | 23.5, -10.2 |
| Integer | 整数 | 100, -50 |
| String | 字符串 | "temperature", "sensor001" |
| Boolean | 布尔值 | true, false |

### 标签数据类型

- 标签值只能是字符串类型
- 标签会被自动索引
- 适合用于过滤和分组

### 时间戳格式

**支持的时间格式**：
- RFC3339: `2024-01-15T10:30:00Z`
- Unix 时间戳: `1642248600`
- 纳秒时间戳: `1642248600000000000`
- 自定义格式: `2024-01-15 10:30:00`

## 💡 最佳实践

### 数据设计原则

**测量设计**：
- 使用有意义的测量名称
- 避免过多细粒度的测量
- 考虑查询模式设计结构

**标签设计**：
- 标签用于元数据和过滤
- 避免高基数标签
- 使用一致的命名规范

**字段设计**：
- 字段存储实际数值
- 合理选择数据类型
- 避免在字段中存储元数据

### 性能优化

**写入优化**：
- 使用批量写入
- 按时间顺序写入数据
- 避免频繁的小批量写入

**数据组织**：
- 合理设计时间精度
- 使用适当的保留策略
- 定期清理过期数据

### 错误处理

**数据验证**：
- 写入前验证数据格式
- 处理时间戳异常
- 检查必需字段

**异常恢复**：
- 记录写入失败的数据
- 支持重试机制
- 提供错误日志

## 🚨 常见问题

### 写入失败

**时间戳问题**：
- 检查时间格式是否正确
- 确认时区设置
- 验证时间戳精度

**数据类型错误**：
- 确认字段数据类型匹配
- 检查数值格式
- 验证字符串编码

**权限问题**：
- 确认用户有写入权限
- 检查数据库是否存在
- 验证连接配置

### 性能问题

**写入速度慢**：
- 增加批量大小
- 检查网络延迟
- 优化数据结构

**内存占用高**：
- 减少批量大小
- 分批处理大文件
- 监控系统资源

## 📈 监控和统计

### 写入统计

- **成功写入数** - 成功写入的数据点数量
- **失败写入数** - 写入失败的数据点数量
- **写入速率** - 每秒写入的数据点数
- **错误率** - 写入失败的比例

### 性能监控

- **写入延迟** - 数据写入的平均延迟
- **队列长度** - 待写入数据的队列长度
- **资源使用** - CPU 和内存使用情况

---

**数据写入是数据分析的基础，正确的写入方式能够提高查询性能和数据质量。** 📊

下一步：[常见问题](./faq.md)
