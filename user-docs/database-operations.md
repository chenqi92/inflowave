# 🗄️ 数据库操作

本指南详细介绍如何在 InfloWave 中进行数据库管理操作，包括数据库的创建、删除、保留策略管理等。

## 📊 数据库管理概述

### 数据库页面布局

- **左侧面板** - 连接和数据库列表
- **右侧主区域** - 数据库详细信息和操作界面
- **顶部工具栏** - 常用操作按钮

### 主要功能

- 数据库创建和删除
- 保留策略管理
- 测量（Measurement）浏览
- 字段和标签查看
- 数据库统计信息

## 🆕 创建数据库

### 基本创建步骤

1. 在左侧选择一个已连接的 InfluxDB 连接
2. 点击 **"创建数据库"** 按钮
3. 填写数据库信息：

   | 字段       | 说明                   | 示例             |
   | ---------- | ---------------------- | ---------------- |
   | 数据库名称 | 数据库的唯一标识符     | `sensor_data`    |
   | 描述       | 数据库用途说明（可选） | `传感器数据存储` |

4. 点击 **"确认"** 创建数据库

### 数据库命名规范

**推荐命名方式**：

- 使用小写字母和下划线
- 避免使用特殊字符和空格
- 使用有意义的名称

**示例**：

- ✅ `sensor_data`
- ✅ `user_metrics`
- ✅ `system_logs`
- ❌ `My Database`
- ❌ `data-2024`

## 🗑️ 删除数据库

### 删除操作

1. 在数据库列表中找到要删除的数据库
2. 右键点击数据库名称
3. 选择 **"删除数据库"**
4. 在确认对话框中输入数据库名称确认删除

> ⚠️ **重要警告**: 删除数据库是不可逆操作，会永久删除所有数据！

### 删除前检查

- 确认数据库中没有重要数据
- 建议先进行数据备份
- 通知相关用户和应用程序

## ⏰ 保留策略管理

保留策略（Retention Policy）控制数据在数据库中的保存时间。

### 查看保留策略

1. 选择数据库后，点击 **"保留策略"** 标签
2. 可以看到当前数据库的所有保留策略
3. 默认策略会标记为 **"默认"**

### 创建保留策略

1. 点击 **"新建策略"** 按钮
2. 填写策略配置：

   | 字段       | 说明               | 示例       |
   | ---------- | ------------------ | ---------- |
   | 策略名称   | 保留策略的名称     | `one_week` |
   | 保留时间   | 数据保留的时间长度 | `7d` (7天) |
   | 分片组时间 | 分片组的时间间隔   | `1d` (1天) |
   | 副本数量   | 数据副本数量       | `1`        |
   | 设为默认   | 是否设为默认策略   | 否         |

3. 点击 **"保存"** 创建策略

### 时间格式说明

| 单位 | 格式 | 示例  | 说明     |
| ---- | ---- | ----- | -------- |
| 分钟 | `m`  | `30m` | 30分钟   |
| 小时 | `h`  | `24h` | 24小时   |
| 天   | `d`  | `7d`  | 7天      |
| 周   | `w`  | `2w`  | 2周      |
| 年   | `y`  | `1y`  | 1年      |
| 无限 | `0s` | `0s`  | 永不过期 |

### 修改保留策略

1. 在保留策略列表中找到要修改的策略
2. 点击 **"编辑"** 按钮
3. 修改相应配置
4. 点击 **"保存"** 应用更改

### 删除保留策略

1. 选择要删除的保留策略
2. 点击 **"删除"** 按钮
3. 确认删除操作

> ⚠️ **注意**: 不能删除默认保留策略，需要先设置其他策略为默认。

## 📏 测量管理

测量（Measurement）类似于关系数据库中的表，存储具体的时序数据。

### 查看测量列表

1. 选择数据库后，可以看到 **"测量列表"** 部分
2. 显示该数据库中的所有测量
3. 可以看到每个测量的基本信息

### 测量操作

#### 右键菜单操作

在测量名称上右键点击，可以执行：

- **查看数据** - 快速查询测量中的数据
- **查看结构** - 显示字段和标签信息
- **复制名称** - 复制测量名称到剪贴板
- **删除测量** - 删除整个测量（谨慎操作）
- **刷新** - 刷新测量信息

#### 查看测量数据

1. 右键点击测量名称
2. 选择 **"查看数据"**
3. 系统会自动跳转到查询页面并执行查询

#### 查看测量结构

1. 右键点击测量名称
2. 选择 **"查看结构"**
3. 可以看到：
   - 字段列表及其数据类型
   - 标签列表
   - 索引信息

## 🏷️ 字段和标签

### 字段（Fields）

- 存储实际的数值数据
- 支持多种数据类型（整数、浮点数、字符串、布尔值）
- 不会被索引，适合存储测量值

### 标签（Tags）

- 存储元数据信息
- 只能是字符串类型
- 会被自动索引，适合用于过滤和分组

### 查看字段和标签

1. 选择测量后，可以看到字段和标签信息
2. 字段显示名称和数据类型
3. 标签显示名称和可能的值

## 📈 数据库统计

### 存储信息

在 **"存储分析"** 标签中可以查看：

- **数据库大小** - 占用的磁盘空间
- **测量数量** - 数据库中的测量总数
- **数据点数量** - 存储的数据点总数
- **时间范围** - 数据的时间跨度

### 性能指标

- **查询响应时间** - 平均查询执行时间
- **写入速率** - 数据写入的速度
- **压缩比** - 数据压缩效率

## 🔧 高级操作

### 数据库备份

虽然 InfloWave 不直接提供备份功能，但可以通过以下方式备份：

1. 使用查询功能导出重要数据
2. 使用 InfluxDB 官方备份工具
3. 定期导出关键测量的数据

### 数据库迁移

1. 从源数据库导出数据
2. 在目标数据库中创建相同结构
3. 导入数据到新数据库
4. 验证数据完整性

### 批量操作

对于多个数据库的批量操作：

1. 使用查询页面编写批量脚本
2. 利用 InfluxQL 的批量操作语法
3. 分批执行避免系统负载过高

## 💡 最佳实践

### 数据库设计

- 合理规划数据库结构
- 避免创建过多小数据库
- 使用有意义的数据库名称

### 保留策略设置

- 根据业务需求设置合适的保留时间
- 考虑存储成本和查询性能
- 定期审查和调整保留策略

### 测量管理

- 使用一致的命名规范
- 合理设计字段和标签
- 避免创建过多细粒度的测量

### 性能优化

- 定期清理无用的数据
- 监控数据库大小和性能
- 合理设置分片组时间

## 🚨 常见问题

### 数据库创建失败

- 检查数据库名称是否符合规范
- 确认用户是否有创建权限
- 验证连接状态是否正常

### 保留策略不生效

- 确认策略配置是否正确
- 检查是否设置为默认策略
- 等待策略生效（可能需要一些时间）

### 测量数据丢失

- 检查保留策略设置
- 确认数据是否超过保留时间
- 验证写入操作是否成功

---

**数据库操作是 InfloWave 的核心功能，熟练掌握这些操作将大大提高您的工作效率。** 📊

下一步：[查询功能](./query-features.md)
